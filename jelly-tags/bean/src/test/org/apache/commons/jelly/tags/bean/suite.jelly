<?xml version="1.0"?>

<test:suite 
	xmlns:j="jelly:core"
	xmlns="jelly:org.apache.commons.jelly.tags.bean.MyTagLibrary" 
	xmlns:test="jelly:junit" 
	xmlns:log="jelly:log">

<test:case name="testNestedBean">

	<customer var="c1" name="James" location="London" >
		<order amount="100" price="2.99">
			<product id="p1" name="Beer"/>
		</order>
		<order amount="200" price="4.99">
			<product id="p2" name="Pizza"/>
		</order>
  </customer>
  
  <log:info>Created a customer with name: ${c1.name} and location: ${c1.location}</log:info>
  <log:info>Customer has orders ${c1.orders}</log:info>

	<test:assertEquals expected="James" actual="${c1.name}"/>
	<test:assertEquals expected="London" actual="${c1.location}"/>

	<test:assertTrue test="${size(c1.orders) == 2}"/>

	<test:assertTrue test="${c1.orders[0].amount == 100}"/>
	<test:assertTrue test="${c1.orders[0].price == 2.99}"/>
	
	<test:assertTrue test="${c1.orders[1].amount == 200}"/>
	<test:assertTrue test="${c1.orders[1].price == 4.99}"/>

	<test:assertTrue test="${c1.orders[0].product != null}"/>
	<test:assertTrue test="${c1.orders[1].product != null}"/>
	
	<test:assertEquals expected="p1" actual="${c1.orders[0].product.id}"/>
	<test:assertEquals expected="Beer" actual="${c1.orders[0].product.name}"/>

	<test:assertEquals expected="p2" actual="${c1.orders[1].product.id}"/>
	<test:assertEquals expected="Pizza" actual="${c1.orders[1].product.name}"/>
	
	
</test:case>


<test:case name="testBeanList">

	<j:useList var="list">
		<customer name="James" location="London">
			<order amount="100" price="2.99">
				<product id="p1" name="Beer"/>
			</order>
			<order amount="200" price="4.99">
				<product id="p2" name="Pizza"/>
			</order>
	  </customer>
		<customer name="Bob" location="Atlanta">
			<order amount="200" price="2.99">
				<product id="p1" name="Beer"/>
			</order>
	  </customer>
	</j:useList>
	  
	<log:info>Created a list of customers ${list}</log:info>

	<test:assertTrue test="${size(list) == 2}"/>

	<test:assertEquals expected="James" actual="${list[0].name}"/>
	<test:assertEquals expected="London" actual="${list[0].location}"/>

	<test:assertTrue test="${size(list[0].orders) == 2}"/>

	<test:assertTrue test="${list[0].orders[0].amount == 100}"/>
	<test:assertTrue test="${list[0].orders[0].price == 2.99}"/>
	
	<test:assertTrue test="${list[0].orders[1].amount == 200}"/>
	<test:assertTrue test="${list[0].orders[1].price == 4.99}"/>

	<test:assertTrue test="${list[0].orders[0].product != null}"/>
	<test:assertTrue test="${list[0].orders[1].product != null}"/>
	
	<test:assertEquals expected="p1" actual="${list[0].orders[0].product.id}"/>
	<test:assertEquals expected="Beer" actual="${list[0].orders[0].product.name}"/>

	<test:assertEquals expected="p2" actual="${list[0].orders[1].product.id}"/>
	<test:assertEquals expected="Pizza" actual="${list[0].orders[1].product.name}"/>
	
	
	<test:assertEquals expected="Bob" actual="${list[1].name}"/>
	<test:assertEquals expected="Atlanta" actual="${list[1].location}"/>

</test:case>

</test:suite>
