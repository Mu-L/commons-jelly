<?xml version="1.0"?>

<j:jelly xmlns:j="jelly:core" xmlns:sql="jelly:sql" xmlns:log="jelly:log">

  <sql:setDataSource 
    url="${databaseUrl}" 
    driver="${databaseDriver}" 
    user="${databaseUser}"
    password="${databasePassword}"/>

  <j:set var="databaseTable" value="dummy"/>


  <log:info>Dropping and recreating the table ${databaseTable}...</log:info>
  
  <j:catch>
    <!-- ignore any exceptions -->
    <sql:update>
      drop table ${databaseTable}
    </sql:update>
  </j:catch>
  	
  <sql:update>
  	create table ${databaseTable} (
  	  id integer,
  	  name varchar(255)
  	)
  </sql:update>


  <log:info>Inserting some data...</log:info>
  
  <j:forEach begin="1" end="20" var="i">
    <sql:update>
      insert into ${databaseTable} (id, name) values (?, ?)
      <sql:param value="${i}"/>
      <sql:param value="Foo_${i}"/>
    </sql:update>
  
  </j:forEach>
  	
  <log:info>Now performing a query...</log:info>
  
  <sql:query var="results">
      select * from ${databaseTable}
  </sql:query>

  <dataSet>

    <!-- we'll turn off whitespace trimming for the loop -->
    <j:forEach trim="false" items="${results.rowsByIndex}" var="row">
      <row>
        <j:forEach var="columnName" items="${results.columnNames}" indexVar="i">
          <field column="${columnName}">${row[i]}</field>                                
        </j:forEach>
      </row>
    </j:forEach>                  

  </dataSet>

</j:jelly>


