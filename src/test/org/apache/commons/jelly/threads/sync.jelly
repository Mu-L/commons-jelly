<?xml version="1.0"?>

<!--
This example shows coordinating between 2 threads using
mutexes and sleep. Thread 1 should execute after thread 2.
-->

<jelly xmlns="jelly:core" xmlns:threads="jelly:threads">

    <threads:mutex var="mutex"/>

    <threads:thread var="thread1">
        <!-- give the other thread a chance to get the mutex -->
        <threads:sleep for="100"/>

        <!-- get the mutex -->
        <threads:synchronize mutex="${mutex}">

            <whitespace>
                [thread1]: finally I got it
            </whitespace>

        </threads:synchronize>
    </threads:thread>

    <threads:thread>
        <!-- get the mutex -->
        <threads:synchronize mutex="${mutex}">

            <whitespace>
                [thread2]: making the other thread wait for 2 secs
            </whitespace>

            <!-- make the other thread wait -->
            <threads:sleep for="2000"/>
        </threads:synchronize>
    </threads:thread>

    <whitespace>
        [main]: waiting for threads to finish
    </whitespace>

    <threads:join thread="${thread1}"/>

    <whitespace>
        [main]: threads are now done
    </whitespace>

</jelly>