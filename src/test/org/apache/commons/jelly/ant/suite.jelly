<?xml version="1.0"?>
<test:suite 
	xmlns:j="jelly:core" 
	xmlns:test="jelly:junit" 
	xmlns:util="jelly:util" 
	xmlns:ant="jelly:jeez">

  <j:set var="dir" value="target/test-classes/org/apache/commons/jelly/ant"/>

<test:case name="write">

  <ant:property name="foo2" value="bar2"/>

  <test:assertEquals
    expected="bar2"
    actual="${foo2}"
  />

</test:case>

<test:case name="readWrite">
  
  <j:set var="foo1" value="bar1"/>

  <ant:property name="foo1.1" value="${foo1}"/>

  <test:assertEquals
    expected="bar1"
    actual="${foo1.1}"
  />

</test:case>

<test:case name="writeIn">

  <ant:ant 
    dir="${dir}"
    target="writeFoo3Bar3"
  />

  <ant:property file="${dir}/test.properties"/>

  <test:assertEquals
    expected="bar3"
    actual="${foo3}"
  />

</test:case>

<test:case name="readWriteIn">

  <j:set var="foo4" value="bar4"/>

  <ant:ant 
    dir="${dir}"
    target="readWriteFoo4.1Foo4"
  />

  <ant:property file="${dir}/test.properties"/>

  <test:assertEquals
    expected="bar4"
    actual="${foo4.1}"
  />

</test:case>

<test:case name="startUpReadWrite">

  <j:set var="foo5" value="bar5"/>

  <ant:ant
    dir="${dir}"
    target="readWriteFoo5.1Foo5InStart"
  />

  <ant:property file="${dir}/test.properties"/>

  <test:assertEquals
    expected="bar5"
    actual="${foo5.1}"
  />

</test:case>

<test:case name="copy">

	<ant:mkdir dir="${base.dir}/target/tmp/ant-tests"/>
	
  <ant:copy
  	overwrite="true"
    file="${basedir}/src/test/org/apache/commons/jelly/ant/sample.txt"
    tofile="${basedir}/target/tmp/ant-tests/output.txt">
    <ant:filterset>
      <ant:filter token="foo" value="bar"/>
    </ant:filterset>
  </ant:copy>
  
  <util:loadText var="text" file="${basedir}/target/tmp/ant-tests/output.txt"/>
  
  <test:assertEquals expected="hello bar how are you?" actual="${text.trim()}"/>

</test:case>

<test:case name="copyWithReference">

	<ant:mkdir dir="${base.dir}/target/tmp/ant-tests"/>

	<ant:filterset id="myFilter">
		<ant:filter token="foo" value="bar"/>
	</ant:filterset>
	
  <ant:copy
  	overwrite="true"
    file="${basedir}/src/test/org/apache/commons/jelly/ant/sample.txt"
    tofile="${basedir}/target/tmp/ant-tests/output.txt">
    <ant:filterset refid="myFilter"/>
  </ant:copy>
  
  <util:loadText var="text" file="${basedir}/target/tmp/ant-tests/output.txt"/>
  
  <test:assertEquals expected="hello bar how are you?" actual="${text.trim()}"/>

</test:case>



<test:case name="startUpReadWrite">

  <j:set var="foo" value="setting the message worked!"/>

	<ant:echo>
		<ant:setProperty name="message" value="${foo}"/>
  </ant:echo>
  
	<ant:echo>
		<ant:setProperty name="message" value="${bar}" default="the default also worked"/>
  </ant:echo>

	<!-- haven't thought of a neat way to test this yet... -->  
</test:case>


</test:suite>
